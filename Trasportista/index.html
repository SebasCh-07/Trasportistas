<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TeLlevo - Prototipo</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">TeLlevo</div>
    
    <div class="session">
      <select id="companySelect">
        <option value="TeLlevo">TeLlevo</option>
        <option value="AndesTours">AndesTours</option>
        <option value="AmazoniaTravel">AmazoniaTravel</option>
      </select>
      <span id="sessionUser">Sin sesión</span>
      <button id="logoutBtn" class="secondary" title="Cerrar sesión">Salir</button>
    </div>
  </header>

  <main id="app">
    <!-- Auth View -->
    <section id="view-auth" class="view">
      <div id="auth-login" class="panel">
          <h2>Iniciar sesión</h2>
          <form id="loginForm" class="form">
          <label>Correo
            <input id="loginEmail" type="email" required />
            </label>
          <label>Contraseña
            <input id="loginPassword" type="password" required />
            </label>
            <button type="submit">Entrar</button>
          </form>
          <div id="loginMsg" class="msg"></div>
        <div class="msg" style="margin-top:10px">
          ¿No tienes cuenta? <a href="#" id="goToRegister">Regístrate</a>
        </div>
        
      </div>
      <div id="auth-register" class="panel" hidden>
        <h2>Registro</h2> 
        <form id="registerForm" class="reg-grid">
          <div class="reg-left">
            <div class="two-col">
              <label>Nombres
                <input id="regNombres" type="text" required />
              </label>
              <label>Apellidos
                <input id="regApellidos" type="text" required />
              </label>
            </div>
            <div class="two-col">
              <label>CI
                <input id="regCedula" type="text" required />
              </label>
              <label>Teléfono
                <input id="regTelefono" type="tel" />
              </label>
            </div>
            <div class="two-col">
              <label>Correo
                <input id="regEmail" type="email" required />
              </label>
              <label>Contraseña
                <input id="regPassword" type="password" required />
              </label>
            </div>
            
            <div class="two-col">
              <div class="map-box">
                <button id="openMapPicker" type="button" class="btn ghost" style="width:100%">Ubicar Dirección en mapa</button>
                <div class="text-muted" id="pickedAddress" style="margin-top:6px"></div>
                <input id="regLat" type="hidden" />
                <input id="regLng" type="hidden" />
              </div>
              <label class="span-1">Referencia
                <input id="regReferencia" type="text" />
              </label>
            </div>
            <button type="submit" class="accent" style="margin-top:10px">Registrar</button>
          </div>
          <div class="reg-right">
            <div class="photo-box">
              <img id="regFotoPreview" alt="Vista previa" hidden />
              <button id="regFotoBtn" class="secondary" type="button">Subir foto</button>
              <input id="regFoto" type="file" accept="image/*" hidden />
            </div>
            <div class="text-muted" style="text-align:center; margin-top:6px">Subir Foto</div>
          </div>
        </form>
        <div id="registerMsg" class="msg"></div>
        <div class="msg" style="margin-top:10px">
          ¿Ya tienes cuenta? <a href="#" id="goToLogin">Inicia sesión</a>
        </div>
      </div>
    </section>

    <!-- Register View (separada) -->
    <section id="view-register" class="view" hidden>
      <div id="auth-register-standalone" class="panel">
          <h2>Registro</h2>
        <form id="registerFormStandalone" class="reg-grid">
          <div class="reg-left">
            <div class="two-col">
              <label>Nombres
                <input id="regNombres" type="text" required />
              </label>
              <label>Apellidos
                <input id="regApellidos" type="text" required />
            </label>
            </div>
            <div class="two-col">
              <label>CI
              <input id="regCedula" type="text" required />
            </label>
              <label>Teléfono
                <input id="regTelefono" type="tel" />
              </label>
            </div>
            <div class="two-col">
              <label>Correo
                <input id="regEmail" type="email" required />
              </label>
              <label>Contraseña
                <input id="regPassword" type="password" required />
            </label>
            </div>
            
            <div class="two-col">
              <div class="map-box">
                <button id="openMapPicker" type="button" class="btn ghost" style="width:100%">Ubicar Dirección en mapa</button>
                <div class="text-muted" id="pickedAddress" style="margin-top:6px"></div>
                <input id="regLat" type="hidden" />
                <input id="regLng" type="hidden" />
              </div>
              <label class="span-1">Referencia
                <input id="regReferencia" type="text" />
              </label>
            </div>
            <button type="submit" class="accent" style="margin-top:10px">Registrar</button>
          </div>
          <div class="reg-right">
            <div class="photo-box">
              <img id="regFotoPreview" alt="Vista previa" hidden />
              <button id="regFotoBtn" class="secondary" type="button">Subir foto</button>
              <input id="regFoto" type="file" accept="image/*" hidden />
            </div>
            <div class="text-muted" style="text-align:center; margin-top:6px">Subir Foto</div>
          </div>
          </form>
          <div id="registerMsg" class="msg"></div>
        <div class="msg" style="margin-top:10px">
          ¿Ya tienes cuenta? <a href="#" id="goToLoginFromRegister">Inicia sesión</a>
        </div>
      </div>
    </section>

    <!-- Cliente View -->
    <section id="view-cliente" class="view">
      <div class="cliente-layout">
        <aside class="cliente-tabs">
          <button class="tab-btn active" data-tab="servicios">Servicios</button>
          <button class="tab-btn" data-tab="mis-viajes">Mis Viajes</button>
          <button class="tab-btn" data-tab="historial">Historial</button>
        </aside>
        <div class="cliente-content">
          <div class="tab-panel active" id="cliente-tab-servicios">
      <div class="panel cliente-left">
        <h2>Servicios</h2>
        <div class="row" style="gap:8px; flex-wrap: wrap;">
          <label class="badge">Elegir servicio</label>
          <select id="servicioTipo">
            <option value="compartido">Compartido (por asiento)</option>
            <option value="privado">Privado (unidad exclusiva)</option>
            <option value="encomienda">Encomienda express</option>
          </select>
        </div>
              <div id="servicioDescripcion" class="servicio-descripcion">
                <p>Selecciona un tipo de servicio para ver su descripción</p>
              </div>
      </div>
      <div class="panel cliente-left" id="compartidoPanel">
        <h2>Rutas disponibles (compartido)</h2>
        <div id="rutasList" class="grid"></div>
      </div>
      <div class="panel cliente-left" id="customServicePanel" hidden>
        <h3>Configurar servicio</h3>
        <form id="customServiceForm" class="form">
          <div class="two-col">
            <label>Origen
                    <div class="row" style="gap:8px; align-items:center;">
                      <select id="csOrigenSelect" style="flex:1"></select>
                      <button type="button" id="csOrigenMapBtn" class="secondary">Nueva dirección</button>
                    </div>
                    <input id="csOrigen" placeholder="Ciudad/Barrio" required style="display:none" />
            </label>
                  <label id="csDestinoWrapper">Destino
              <input id="csDestino" placeholder="Ciudad/Barrio" required />
            </label>
                  <label id="csRutaWrapper" style="display:none">Destino (preestablecido)
                    <select id="csRutaSelect"></select>
                  </label>
                </div>
                
                <!-- Campos específicos para servicio privado -->
                <div id="servicioPrivadoFields" style="display: none;">
                  <div class="two-col">
                    <label>Número de pasajeros
                      <input id="csPersonas" type="number" min="1" max="8" placeholder="Ej. 4" />
                    </label>
                    <label>Tipo de vehículo preferido
                      <select id="csTipoVehiculo">
                        <option value="sedan">Sedán (1-4 personas)</option>
                        <option value="suv">SUV (1-6 personas)</option>
                        <option value="van">Van (1-8 personas)</option>
                      </select>
                    </label>
                  </div>
                  <label>Comentarios especiales
                    <input id="csComentarios" placeholder="Equipaje especial, paradas intermedias, etc." />
                  </label>
          </div>

                <!-- Campos específicos para encomienda -->
                <div id="servicioEncomiendaFields" style="display: none;">
          <div class="two-col">
                    <label>Tamaño del paquete
                      <select id="csTamanoPaquete">
                        <option value="pequeno">Pequeño (hasta 5kg)</option>
                        <option value="mediano">Mediano (5-15kg)</option>
                        <option value="grande">Grande (15-30kg)</option>
                      </select>
            </label>
                    <label>Tipo de contenido
                      <select id="csTipoContenido">
                        <option value="documentos">Documentos</option>
                        <option value="ropa">Ropa/Textiles</option>
                        <option value="electronico">Electrónicos</option>
                        <option value="fragil">Frágil</option>
                        <option value="otro">Otro</option>
                      </select>
            </label>
          </div>
                  <label>Descripción del contenido
                    <input id="csDescripcionPaquete" placeholder="Describe brevemente el contenido" />
          </label>
                </div>

                <button type="submit" class="accent">Solicitar cotización</button>
        </form>
      </div>
      <div class="panel cliente-right" id="reservaPanel" hidden>
        <h3>Reservar</h3>
        <div id="reservaInfo"></div>
        <form id="reservaForm" class="form">
          <label>Tipo
            <select id="tipoReserva">
              <option value="asiento">Asiento</option>
              <option value="encomienda">Encomienda</option>
            </select>
          </label>
          <label>Dirección de recogida
            <input id="direccion" type="text" placeholder="Calle y número" required />
          </label>
          <div class="two-col">
            <label>Método de pago
              <select id="metodoPago">
                <option value="efectivo">Efectivo</option>
                <option value="tarjeta">Tarjeta</option>
                <option value="transferencia">Transferencia</option>
                <option value="voucher">Voucher empresarial</option>
              </select>
            </label>
            <label>Cupón/Voucher (opcional)
              <input id="codigoPromo" placeholder="CUPON10 o VOC-123" />
            </label>
          </div>
          <button type="submit" class="accent">Confirmar reserva</button>
        </form>
        <div id="reservaMsg" class="msg"></div>
      </div>
      <div class="panel cliente-right" id="trackingPanel" hidden>
        <h3>Tracking en vivo</h3>
        <div id="trackingInfo" class="list"></div>
      </div>
          </div>

          <div class="tab-panel" id="cliente-tab-mis-viajes">
            <div class="panel">
              <h2>Mis Viajes Activos</h2>
              <div class="viajes-tabs">
                <button class="viajes-tab-btn active" data-status="pendientes">Pendientes</button>
                <button class="viajes-tab-btn" data-status="en-curso">En Curso</button>
              </div>
              <div class="viajes-content">
                <div class="viajes-panel active" id="viajes-pendientes">
                  <div id="viajesPendientesList" class="list"></div>
                </div>
                <div class="viajes-panel" id="viajes-en-curso">
                  <div id="viajesEnCursoList" class="list"></div>
                </div>
              </div>
            </div>
            <div class="panel" id="trackingClientePanel">
              <h3>Tracking en Tiempo Real</h3>
              <div id="trackingClienteInfo" class="list"></div>
            </div>
          </div>

          <div class="tab-panel" id="cliente-tab-historial">
            <div class="panel">
              <h2>Historial de Reservas</h2>
        <div id="historialList" class="list"></div>
            </div>
            <div class="panel">
              <h3>Calificar Servicio</h3>
              <form id="ratingForm" class="form">
          <div class="two-col">
                  <label>Reserva completada
              <select id="ratingReserva"></select>
            </label>
            <label>Puntaje (1-5)
              <input id="ratingValor" type="number" min="1" max="5" step="1" />
            </label>
          </div>
          <label>Comentario (opcional)
                  <input id="ratingComentario" placeholder="Cuéntanos sobre tu experiencia" />
          </label>
                <button type="submit" class="accent">Enviar calificación</button>
          <div id="ratingMsg" class="msg"></div>
        </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Empresa View -->
    <section id="view-empresa" class="view">
      <div class="cliente-layout">
        <aside class="cliente-tabs">
          <button class="tab-btn active" data-tab="servicios">Servicios</button>
          <button class="tab-btn" data-tab="mis-viajes">Mis Viajes</button>
          <button class="tab-btn" data-tab="historial">Historial</button>
        </aside>
        <main class="cliente-content">
          <!-- Servicios Tab -->
          <div class="tab-panel active" id="tab-servicios">
            <h2>Servicios de Transporte</h2>
            
            <!-- Servicios Compartidos -->
            <div class="panel">
              <h3>Servicios Compartidos</h3>
              <div id="rutasListEmpresa" class="grid"></div>
            </div>

            <!-- Servicios Privados -->
            <div class="panel">
              <h3>Servicios Privados</h3>
              <form id="customServiceFormEmpresa" class="form">
                <div class="row" style="gap:8px; flex-wrap: wrap;">
                  <label class="badge">Elegir servicio</label>
                  <select id="servicioTipoEmpresa">
                    <option value="compartido">Compartido (por asiento)</option>
                    <option value="privado">Privado (unidad exclusiva)</option>
                  </select>
                </div>
                <div id="servicioDescripcionEmpresa" class="servicio-descripcion">
                  <p>Selecciona un tipo de servicio para ver su descripción</p>
                </div>

                <!-- Campos para servicio privado -->
                <div id="servicioPrivadoFieldsEmpresa" style="display: none;">
                  <div class="two-col">
                    <label>Origen
                      <select id="csOrigenSelectEmpresa">
                        <option value="mi-direccion">Mi dirección</option>
                        <option value="favoritas">Favoritas</option>
                        <option value="nueva">Nueva dirección</option>
                      </select>
                    </label>
                    <button type="button" id="csOrigenMapBtnEmpresa" style="display: none;">📍 Nueva dirección</button>
                  </div>
                  <div class="two-col">
                    <label>Destino
                      <select id="csRutaSelectEmpresa">
                        <option value="">Selecciona destino</option>
                      </select>
                    </label>
                    <label>Pasajeros
                      <input id="csPasajerosEmpresa" type="number" min="1" max="8" value="1" />
                    </label>
                  </div>
                  <div class="two-col">
                    <label>Tipo de vehículo
                      <select id="csTipoVehiculoEmpresa">
                        <option value="sedan">Sedán</option>
                        <option value="suv">SUV</option>
                        <option value="van">Van</option>
                      </select>
                    </label>
                    <label>Comentarios
                      <input id="csComentariosEmpresa" placeholder="Equipaje especial, paradas intermedias, etc." />
                    </label>
                  </div>
                </div>

                <button type="submit" class="primary">Solicitar cotización</button>
              </form>
            </div>
          </div>

          <!-- Mis Viajes Tab -->
          <div class="tab-panel" id="tab-mis-viajes-empresa">
            <h2>Mis Viajes</h2>
            <div class="two-col">
              <div class="panel">
                <h3>Pendientes</h3>
                <div id="viajesPendientesListEmpresa" class="list"></div>
              </div>
              <div class="panel">
                <h3>En Curso</h3>
                <div id="viajesEnCursoListEmpresa" class="list"></div>
              </div>
            </div>
            
            <!-- Tracking en tiempo real -->
            <div id="trackingPanelEmpresa" class="panel" hidden>
              <h3>Tracking en Tiempo Real</h3>
              <div id="trackingInfoEmpresa" class="list"></div>
            </div>
          </div>

          <!-- Historial Tab -->
          <div class="tab-panel" id="tab-historial-empresa">
            <h2>Historial de Viajes</h2>
            <div id="historialListEmpresa" class="list"></div>
          </div>
        </main>
      </div>
    </section>

    <!-- Conductor View -->
    <section id="view-conductor" class="view">
      <div class="conductor-layout">
        <aside class="conductor-tabs">
          <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
          <button class="tab-btn" data-tab="asignaciones">Asignaciones</button>
        </aside>
        <div class="conductor-content">
          <div class="tab-panel active" id="conductor-tab-dashboard">
            <div class="panel">
              <h2>Dashboard</h2>
              <div class="kpis">
                <div class="kpi"><div class="kpi-num" id="conductorTotalAsignaciones">0</div><div class="kpi-label">Total Asignaciones</div></div>
                <div class="kpi"><div class="kpi-num" id="conductorPendientes">0</div><div class="kpi-label">Pendientes</div></div>
                <div class="kpi"><div class="kpi-num" id="conductorEnCurso">0</div><div class="kpi-label">En Curso</div></div>
                <div class="kpi"><div class="kpi-num" id="conductorCompletadas">0</div><div class="kpi-label">Completadas</div></div>
              </div>
            </div>
            <div class="panel">
              <h3>Próximos viajes</h3>
              <div id="proximosViajes" class="list"></div>
            </div>
          </div>

          <div class="tab-panel" id="conductor-tab-asignaciones">
      <div class="panel">
              <h2>Mis Asignaciones</h2>
              
              <div class="asignaciones-tabs">
                <button class="asig-tab-btn active" data-status="asignado">Asignado</button>
                <button class="asig-tab-btn" data-status="en-curso">En Curso</button>
                <button class="asig-tab-btn" data-status="finalizado">Finalizado</button>
              </div>

              <div class="asig-content">
                <div class="asig-panel active" id="asig-asignado">
        <div id="viajesAsignados" class="list"></div>
      </div>
                <div class="asig-panel" id="asig-en-curso">
                  <div id="viajesEnCurso" class="list"></div>
                </div>
                <div class="asig-panel" id="asig-finalizado">
                  <div id="viajesFinalizados" class="list"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Admin View -->
    <section id="view-admin" class="view">
      <div class="admin-layout">
        <aside class="admin-tabs">
          <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
          <button class="tab-btn" data-tab="usuarios">Usuarios</button>
          <button class="tab-btn" data-tab="clientes">Clientes</button>
          <button class="tab-btn" data-tab="flota">Flota</button>
          <button class="tab-btn" data-tab="rutas">Rutas</button>
          <button class="tab-btn" data-tab="reservas">Reservas</button>
          <button class="tab-btn" data-tab="promos">Cupones/Vouchers</button>
          <button class="tab-btn" data-tab="gps">GPS</button>
        </aside>
        <div class="admin-content">
          <div class="tab-panel active" id="tab-dashboard">
            <!-- Métricas Principales -->
            <div class="dashboard-section">
              <div class="section-header">
                <h2>📊 Resumen General</h2>
                <p class="section-desc">Indicadores clave de rendimiento del negocio</p>
              </div>
              <div class="kpis-grid">
                <div class="kpi-card kpi-primary">
                  <div class="kpi-icon">💼</div>
                  <div class="kpi-content">
                    <div class="kpi-num" id="kpiReservas">0</div>
                    <div class="kpi-label">Total Reservas</div>
                    <div class="kpi-sublabel">Todas las solicitudes</div>
                  </div>
                </div>
                <div class="kpi-card kpi-success">
                  <div class="kpi-icon">💰</div>
                  <div class="kpi-content">
                    <div class="kpi-num" id="kpiRevenue">$0</div>
                    <div class="kpi-label">Ingresos Totales</div>
                    <div class="kpi-sublabel">Facturación acumulada</div>
                  </div>
                </div>
                <div class="kpi-card kpi-info">
                  <div class="kpi-icon">🚗</div>
                  <div class="kpi-content">
                    <div class="kpi-num" id="kpiFlota">0</div>
                    <div class="kpi-label">Vehículos Activos</div>
                    <div class="kpi-sublabel">Flota disponible</div>
                  </div>
                </div>
                <div class="kpi-card kpi-warning">
                  <div class="kpi-icon">⭐</div>
                  <div class="kpi-content">
                    <div class="kpi-num" id="kpiRating">-</div>
                    <div class="kpi-label">Calificación</div>
                    <div class="kpi-sublabel">Promedio del servicio</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Estado Operacional -->
            <div class="dashboard-section">
              <div class="section-header">
                <h3>🚦 Estado Operacional</h3>
                <p class="section-desc">Monitoreo en tiempo real de las operaciones</p>
              </div>
              <div class="operational-grid">
                <div class="operational-card">
                  <div class="op-header">
                    <span class="op-icon">⏳</span>
                    <span class="op-title">Reservas Pendientes</span>
                  </div>
                  <div class="op-content">
                    <div class="op-number" id="opPendientes">0</div>
                    <div class="op-desc">Sin asignar conductor</div>
                  </div>
                </div>
                <div class="operational-card">
                  <div class="op-header">
                    <span class="op-icon">🚗</span>
                    <span class="op-title">Viajes en Curso</span>
                  </div>
                  <div class="op-content">
                    <div class="op-number" id="opEnCurso">0</div>
                    <div class="op-desc">Actualmente ejecutándose</div>
                  </div>
                </div>
                <div class="operational-card">
                  <div class="op-header">
                    <span class="op-icon">✅</span>
                    <span class="op-title">Completados Hoy</span>
                  </div>
                  <div class="op-content">
                    <div class="op-number" id="opCompletadosHoy">0</div>
                    <div class="op-desc">Finalizados exitosamente</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Análisis y Reportes -->
            <div class="dashboard-section">
              <div class="section-header">
                <h3>📈 Análisis y Reportes</h3>
                <p class="section-desc">Datos detallados para la toma de decisiones</p>
              </div>
              <div class="analysis-grid">
                <div class="analysis-card">
                  <div class="card-header">
                    <h4>🕒 Actividad Reciente</h4>
                    <span class="card-badge">Últimas 24h</span>
                  </div>
                  <div id="adminRecent" class="analysis-content"></div>
                </div>
                <div class="analysis-card">
                  <div class="card-header">
                    <h4>🗺️ Rutas Más Populares</h4>
                    <span class="card-badge">Top 5</span>
                  </div>
                  <div id="adminTopRutas" class="analysis-content"></div>
                </div>
                <div class="analysis-card">
                  <div class="card-header">
                    <h4>🚛 Utilización de Flota</h4>
                    <span class="card-badge">Estado actual</span>
                  </div>
                  <div id="adminFleetStats" class="analysis-content"></div>
                </div>
                <div class="analysis-card">
                  <div class="card-header">
                    <h4>🎟️ Promociones Activas</h4>
                    <span class="card-badge">Uso actual</span>
                  </div>
                  <div id="adminPromoStats" class="analysis-content"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-panel" id="tab-usuarios">
            <div class="panel">
              <h3>Usuarios</h3>
              <div class="row" style="justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span class="text-muted">Gestión de conductores y administradores</span>
                <button class="btn primary" id="addUsuarioBtn">+ Agregar Usuario</button>
              </div>
              <div id="adminUsuarios" class="list"></div>
            </div>
          </div>

          <div class="tab-panel" id="tab-clientes">
            <div class="panel">
              <h3>Clientes</h3>
              <div class="row" style="justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span class="text-muted">Gestión de clientes registrados</span>
              </div>
              <div id="adminClientes" class="list"></div>
            </div>
          </div>

          <div class="tab-panel" id="tab-flota">
      <div class="panel">
              <h3>Flota</h3>
              <div class="row" style="justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span class="text-muted">Gestión de vehículos de la flota</span>
                <button class="btn primary" id="addFlotaBtn">+ Agregar Vehículo</button>
              </div>
              <div id="adminFlota" class="list"></div>
        </div>
      </div>

          <div class="tab-panel" id="tab-rutas">
            <div class="panel">
          <h3>Gestión de rutas</h3>
          <div id="adminRutas" class="list"></div>
          <form id="rutaForm" class="form inline">
            <input id="rutaOrigen" placeholder="Origen" required />
            <input id="rutaDestino" placeholder="Destino" required />
            <input id="rutaHorario" placeholder="Horario (HH:MM)" required />
            <input id="rutaPrecio" type="number" placeholder="Precio" required />
            <input id="rutaAsientos" type="number" placeholder="Asientos" required />
            <button type="submit">Añadir ruta</button>
          </form>
          <div id="rutaMsg" class="msg"></div>
        </div>
          </div>

          <div class="tab-panel" id="tab-reservas">
            <div class="panel">
              <h3>Gestión de reservas</h3>
              <div class="row" style="gap:6px; flex-wrap: wrap; margin-bottom:8px">
                <button class="btn secondary res-filter-btn active" data-filter="pendiente">Pendientes</button>
                <button class="btn secondary res-filter-btn" data-filter="asignadas">Asignadas</button>
                <button class="btn secondary res-filter-btn" data-filter="recogido">Completadas</button>
              </div>
          <div id="adminReservas" class="list"></div>
            </div>
          </div>

          <div class="tab-panel" id="tab-promos">
            <div class="panel">
              <h3>Cupones y Vouchers</h3>
          <div id="adminPromos" class="list"></div>
          <form id="promoForm" class="form inline" style="grid-template-columns: 1fr 1fr auto;">
            <select id="promoTipo">
              <option value="cupon">Cupón</option>
              <option value="voucher">Voucher</option>
            </select>
            <input id="promoCodigo" placeholder="CUPON10 o VOC-001" required />
            <button type="submit">Agregar</button>
          </form>
          <div id="promoMsg" class="msg"></div>
        </div>
          </div>

          <div class="tab-panel" id="tab-gps">
            <div class="panel">
              <h3>Monitoreo GPS</h3>
              <div class="row" style="gap:8px; flex-wrap: wrap; margin-bottom:8px;">
                <label style="flex:1">Filtrar conductor
                  <input id="gpsFilter" placeholder="Nombre del conductor" />
                </label>
                <span class="badge" id="gpsCount">0 activos</span>
              </div>
              <div id="adminGpsMap" style="height: 55vh; border:1px solid var(--border); border-radius: 12px;"></div>
              <div id="adminGpsList" class="list" style="margin-top:10px"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Admin Create Vehicle View -->
    <section id="view-admin-vehicle-new" class="view" hidden>
      <div class="panel" style="max-width: 900px; margin: 0 auto;">
        <h2>Nuevo Vehículo</h2>
        <form id="adminCreateVehicleForm" class="form">
          <div class="two-col">
            <label>Placa del vehículo
              <input id="avPlaca" type="text" placeholder="ABC-123" required />
            </label>
            <label>Tipo de vehículo
              <select id="avTipo" required>
                <option value="sedan">Sedán</option>
                <option value="suv">SUV</option>
                <option value="van">Van</option>
                <option value="bus">Bus</option>
                <option value="microbus">Microbús</option>
              </select>
            </label>
          </div>
          <div class="two-col">
            <label>Marca
              <input id="avMarca" type="text" placeholder="Toyota, Chevrolet, etc." required />
            </label>
            <label>Modelo
              <input id="avModelo" type="text" placeholder="Corolla, Aveo, etc." required />
            </label>
          </div>
          <div class="two-col">
            <label>Año
              <input id="avAño" type="number" min="1990" max="2024" placeholder="2020" required />
            </label>
            <label>Capacidad (pasajeros)
              <input id="avCapacidad" type="number" min="1" max="50" placeholder="5" required />
            </label>
          </div>
          <div class="two-col">
            <label>Color
              <input id="avColor" type="text" placeholder="Blanco, Negro, etc." />
            </label>
            <label>Estado del vehículo
              <select id="avEstado" required>
                <option value="activo">Activo</option>
                <option value="mantenimiento">En Mantenimiento</option>
                <option value="inactivo">Inactivo</option>
              </select>
            </label>
          </div>
          <label>Número de SOAT
            <input id="avSoat" type="text" placeholder="Opcional" />
          </label>
          <label>Observaciones
            <input id="avObservaciones" type="text" placeholder="Notas adicionales sobre el vehículo" />
          </label>
          <div class="row" style="justify-content: flex-end; gap: 8px; margin-top: 16px;">
            <button type="button" id="avCancelar" class="secondary">Cancelar</button>
            <button type="submit" class="accent">Agregar Vehículo</button>
          </div>
          <div id="avMsg" class="msg"></div>
        </form>
      </div>
    </section>

    <!-- Admin Create User View -->
    <section id="view-admin-user-new" class="view" hidden>
      <div class="panel" style="max-width: 900px; margin: 0 auto;">
        <h2>Nuevo usuario</h2>
        <form id="adminCreateUserForm" class="form">
          <div class="two-col">
            <label>Nombre completo
              <input id="auNombre" type="text" required />
            </label>
            <label>CI
              <input id="auCedula" type="text" required />
            </label>
          </div>
          <div class="two-col">
            <label>Rol
              <select id="auRole" required>
                <option value="conductor">Conductor</option>
                <option value="admin">Administrador</option>
              </select>
            </label>
            <label>Teléfono
              <input id="auTelefono" type="tel" />
            </label>
          </div>
          <div class="two-col">
            <label>Correo
              <input id="auEmail" type="email" required />
            </label>
            <label>Contraseña
              <input id="auPassword" type="password" required />
            </label>
          </div>
          <label>Dirección
            <input id="auDireccion" type="text" />
          </label>
          <div class="two-col">
            <div class="photo-box">
              <img id="auFotoPreview" alt="Vista previa" hidden />
              <button id="auFotoBtn" class="secondary" type="button">Subir foto</button>
              <input id="auFoto" type="file" accept="image/*" hidden />
            </div>
            <div class="text-muted" style="display:flex; align-items:center">Foto del usuario (opcional)</div>
          </div>
          <div class="row" style="justify-content: flex-end; gap: 8px; margin-top: 8px;">
            <button type="button" id="auCancelar" class="secondary">Cancelar</button>
            <button type="submit" class="accent">Crear usuario</button>
          </div>
          <div id="auMsg" class="msg"></div>
        </form>
      </div>
    </section>
  </main>


  <div id="toast" class="toast" hidden></div>

  <!-- Modal Ver Reserva -->
  <div id="verReservaModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Detalles de la Reserva</h3>
        <button id="closeVerReservaModal" class="btn secondary">&times;</button>
      </div>
      <div class="modal-body">
        <div id="verReservaContent"></div>
      </div>
      <div class="modal-footer">
        <button id="closeVerReservaModalBtn" class="btn secondary">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Modal Asignar Reserva -->
  <div id="asignarReservaModal" class="modal" hidden>
    <div class="modal-content" style="max-width: 700px;">
      <div class="modal-header">
        <h3>Asignar Reserva</h3>
        <button id="closeAsignarReservaModal" class="btn secondary">&times;</button>
      </div>
      <div class="modal-body">
        <div id="asignarReservaInfo" style="margin-bottom: 20px; padding: 16px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 4px solid var(--primary);"></div>
        <form id="asignarReservaForm" class="form">
          <div class="two-col">
            <label>Conductor asignado
              <select id="asignarConductor" required>
                <option value="">Seleccionar conductor...</option>
              </select>
            </label>
            <label>Vehículo asignado
              <select id="asignarVehiculo" required>
                <option value="">Seleccionar vehículo...</option>
              </select>
            </label>
          </div>
          <div class="two-col">
            <label>Hora de recogida estimada
              <input id="asignarHoraRecogida" type="time" required />
            </label>
            <label>Duración estimada (minutos)
              <input id="asignarDuracion" type="number" min="5" max="480" placeholder="60" required />
            </label>
          </div>
          <label>Observaciones para el conductor
            <textarea id="asignarObservaciones" rows="3" placeholder="Instrucciones especiales, notas sobre la ruta, etc."></textarea>
          </label>
          <div class="two-col">
            <label>Precio final
              <input id="asignarPrecio" type="number" step="0.01" min="0" placeholder="0.00" required />
            </label>
            <label>Prioridad del viaje
              <select id="asignarPrioridad">
                <option value="normal">Normal</option>
                <option value="alta">Alta</option>
                <option value="urgente">Urgente</option>
              </select>
            </label>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button id="cancelarAsignarReserva" class="btn secondary">Cancelar</button>
        <button id="confirmarAsignarReserva" class="btn accent">Asignar Reserva</button>
      </div>
      <div id="asignarReservaMsg" class="msg"></div>
    </div>
  </div>

  <!-- Modal Editar Reserva -->
  <div id="editarReservaModal" class="modal" hidden>
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h3>Editar Reserva</h3>
        <button id="closeEditarReservaModal" class="btn secondary">&times;</button>
      </div>
      <div class="modal-body">
        <form id="editarReservaForm" class="form">
          <div class="two-col">
            <label>Estado de la reserva
              <select id="editarEstado" required>
                <option value="pendiente">Pendiente</option>
                <option value="confirmada">Confirmada</option>
                <option value="en-curso">En Curso</option>
                <option value="recogido">Completada</option>
                <option value="cancelada">Cancelada</option>
              </select>
            </label>
            <label>Método de pago
              <select id="editarMetodoPago">
                <option value="efectivo">Efectivo</option>
                <option value="tarjeta">Tarjeta</option>
                <option value="transferencia">Transferencia</option>
                <option value="voucher">Voucher empresarial</option>
              </select>
            </label>
          </div>
          <div class="two-col">
            <label>Precio
              <input id="editarPrecio" type="number" step="0.01" min="0" required />
            </label>
            <label>Promoción aplicada
              <input id="editarPromo" type="text" placeholder="Código de promoción" />
            </label>
          </div>
          <label>Dirección de recogida
            <input id="editarDireccion" type="text" required />
          </label>
          <label>Notas adicionales
            <textarea id="editarNotas" rows="3" placeholder="Observaciones o cambios especiales"></textarea>
          </label>
        </form>
      </div>
      <div class="modal-footer">
        <button id="cancelarEditarReserva" class="btn secondary">Cancelar</button>
        <button id="confirmarEditarReserva" class="btn accent">Guardar Cambios</button>
      </div>
      <div id="editarReservaMsg" class="msg"></div>
    </div>
  </div>

  <!-- Detalles Modal -->
  <div id="detallesModal" class="modal" hidden>
    <div class="modal-content">
      <div class="modal-header">
        <h3>Detalles de la Asignación</h3>
        <button id="closeDetallesModal" class="btn secondary">&times;</button>
      </div>
      <div class="modal-body">
        <div id="detallesContent"></div>
      </div>
      <div class="modal-footer">
        <button id="closeDetallesModalBtn" class="btn secondary">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Ver Usuario Modal -->
  <div id="verUsuarioModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>👤 Detalles del Usuario</h3>
        <button class="close-btn" onclick="cerrarVerUsuarioModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="verUsuarioContent" class="view-content"></div>
      </div>
      <div class="modal-footer">
        <button class="btn secondary" onclick="cerrarVerUsuarioModal()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Editar Usuario Modal -->
  <div id="editarUsuarioModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>✏️ Editar Usuario</h3>
        <button class="close-btn" onclick="cerrarEditarUsuarioModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="editarUsuarioForm">
          <div class="form-group">
            <label for="euNombre">Nombre Completo:</label>
            <input type="text" id="euNombre" required>
          </div>
          <div class="form-group">
            <label for="euCedula">Cédula:</label>
            <input type="text" id="euCedula" required>
          </div>
          <div class="form-group">
            <label for="euEmail">Email:</label>
            <input type="email" id="euEmail">
          </div>
          <div class="form-group">
            <label for="euTelefono">Teléfono:</label>
            <input type="tel" id="euTelefono">
          </div>
          <div class="form-group">
            <label for="euRole">Rol:</label>
            <select id="euRole" required>
              <option value="conductor">Conductor</option>
              <option value="admin">Administrador</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn secondary" onclick="cerrarEditarUsuarioModal()">Cancelar</button>
        <button class="btn primary" id="confirmarEditarUsuario">Guardar Cambios</button>
      </div>
    </div>
  </div>

  <!-- Ver Cliente Modal -->
  <div id="verClienteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>👤 Detalles del Cliente</h3>
        <button class="close-btn" onclick="cerrarVerClienteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="verClienteContent" class="view-content"></div>
      </div>
      <div class="modal-footer">
        <button class="btn secondary" onclick="cerrarVerClienteModal()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Editar Cliente Modal -->
  <div id="editarClienteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>✏️ Editar Cliente</h3>
        <button class="close-btn" onclick="cerrarEditarClienteModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="editarClienteForm">
          <div class="form-group">
            <label for="ecNombre">Nombre Completo:</label>
            <input type="text" id="ecNombre" required>
          </div>
          <div class="form-group">
            <label for="ecCedula">Cédula:</label>
            <input type="text" id="ecCedula" required>
          </div>
          <div class="form-group">
            <label for="ecEmail">Email:</label>
            <input type="email" id="ecEmail">
          </div>
          <div class="form-group">
            <label for="ecTelefono">Teléfono:</label>
            <input type="tel" id="ecTelefono">
          </div>
          <div class="form-group">
            <label for="ecDireccion">Dirección:</label>
            <input type="text" id="ecDireccion">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn secondary" onclick="cerrarEditarClienteModal()">Cancelar</button>
        <button class="btn primary" id="confirmarEditarCliente">Guardar Cambios</button>
      </div>
    </div>
  </div>

  <!-- Ver Vehículo Modal -->
  <div id="verVehiculoModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>🚗 Detalles del Vehículo</h3>
        <button class="close-btn" onclick="cerrarVerVehiculoModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="verVehiculoContent" class="view-content"></div>
      </div>
      <div class="modal-footer">
        <button class="btn secondary" onclick="cerrarVerVehiculoModal()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Editar Vehículo Modal -->
  <div id="editarVehiculoModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>✏️ Editar Vehículo</h3>
        <button class="close-btn" onclick="cerrarEditarVehiculoModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="editarVehiculoForm">
          <div class="form-group">
            <label for="evPlaca">Placa:</label>
            <input type="text" id="evPlaca" required readonly>
          </div>
          <div class="form-group">
            <label for="evTipo">Tipo de Vehículo:</label>
            <select id="evTipo" required>
              <option value="sedan">Sedán</option>
              <option value="suv">SUV</option>
              <option value="van">Van</option>
              <option value="camioneta">Camioneta</option>
              <option value="bus">Bus</option>
            </select>
          </div>
          <div class="form-group">
            <label for="evMarca">Marca:</label>
            <input type="text" id="evMarca" required>
          </div>
          <div class="form-group">
            <label for="evModelo">Modelo:</label>
            <input type="text" id="evModelo" required>
          </div>
          <div class="form-group">
            <label for="evAño">Año:</label>
            <input type="number" id="evAño" min="1990" max="2030" required>
          </div>
          <div class="form-group">
            <label for="evCapacidad">Capacidad:</label>
            <input type="number" id="evCapacidad" min="1" max="50" required>
          </div>
          <div class="form-group">
            <label for="evColor">Color:</label>
            <input type="text" id="evColor" required>
          </div>
          <div class="form-group">
            <label for="evConductor">Conductor Asignado:</label>
            <select id="evConductor">
              <option value="">Sin asignar</option>
            </select>
          </div>
          <div class="form-group">
            <label for="evObservaciones">Observaciones:</label>
            <textarea id="evObservaciones" rows="3"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn secondary" onclick="cerrarEditarVehiculoModal()">Cancelar</button>
        <button class="btn primary" id="confirmarEditarVehiculo">Guardar Cambios</button>
      </div>
    </div>
  </div>

  <!-- Map Picker Modal -->
  <div id="mapModal" class="panel" hidden style="position: fixed; inset: 0; margin: auto; max-width: 900px; max-height: 80vh; z-index: 100; grid-template-rows: auto 1fr auto; gap: 10px;">
    <div class="row" style="justify-content: space-between; align-items: center;">
      <strong>Seleccionar ubicación</strong>
      <button id="closeMapPicker" class="secondary">Cerrar</button>
    </div>
    <div id="map" style="height: 60vh; border:1px solid var(--border); border-radius: 10px;"></div>
    <div class="row" style="gap:10px; flex-wrap: wrap;">
      <span class="badge" id="mapCoords">-,-</span>
      <span class="text-muted" id="mapAddress"></span>
      <button id="saveMapPicker" class="accent">Usar esta ubicación</button>
    </div>
  </div>

  <!-- Modal Asignación -->
  <div id="assignModal" class="panel" hidden style="position: fixed; inset: 0; margin: auto; max-width: 720px; max-height: 80vh; z-index: 70; display: grid; grid-template-rows: auto 1fr auto; gap: 10px;">
    <div class="row" style="justify-content: space-between; align-items: center;">
      <strong>Asignar reserva</strong>
      <button id="assignClose" class="secondary">Cerrar</button>
    </div>
    <div style="min-height:0; overflow:auto;">
      <div class="row" style="gap:8px; flex-wrap: wrap;">
        <label style="flex:1">Conductor
          <select id="assignConductorSelect"></select>
        </label>
        <label style="flex:1">Vehículo
          <select id="assignVehiculoSelect"></select>
        </label>
      </div>
      <div id="assignInfo" class="text-muted" style="margin-top:6px"></div>
      <div id="assignDetails" class="list" style="margin-top:8px"></div>
    </div>
    <div class="row" style="justify-content: flex-end; gap: 8px;">
      <button id="assignSave" class="accent">Asignar</button>
    </div>
  </div>

  <!-- Modal Detalle Reserva (Conductor) -->
  <div id="driverDetailModal" class="panel" hidden style="position: fixed; inset: 0; margin: auto; max-width: 680px; max-height: 80vh; z-index: 70; grid-template-rows: auto 1fr auto; gap: 10px;">
    <div class="row" style="justify-content: space-between; align-items: center;">
      <strong>Detalles de la reserva</strong>
      <button id="driverDetailClose" class="secondary">Cerrar</button>
    </div>
    <div id="driverDetailBody" style="min-height:0; overflow:auto;"></div>
    <div class="row" style="justify-content: flex-end; gap: 8px;">
      <button id="driverDetailOk" class="accent">Entendido</button>
    </div>
  </div>

  <!-- Modal Confirmación de reserva (Cliente) -->
  <div id="clientConfirmModal" class="panel" hidden style="position: fixed; inset: 0; margin: auto; max-width: 720px; max-height: 80vh; z-index: 70; grid-template-rows: auto 1fr auto; gap: 10px;">
    <div class="row" style="justify-content: space-between; align-items: center;">
      <strong>Confirmar reserva</strong>
      <button id="clientConfirmClose" class="secondary">Cerrar</button>
    </div>
    <div style="min-height:0; overflow:auto;">
      <div id="clientConfirmDetails" class="list"></div>
      <form id="clientConfirmForm" class="form" style="margin-top:10px">
        <div class="row" style="justify-content: flex-end; gap: 8px;">
          <button type="submit" class="accent">Continuar a pago</button>
        </div>
      </form>
    </div>
    <div class="row" style="justify-content: flex-end; gap: 8px;"></div>
  </div>

  <!-- Modal Reserva Compartido (Cliente) -->
  <div id="clientSharedModal" class="panel" hidden style="position: fixed; inset: 0; margin: auto; max-width: 760px; max-height: 82vh; z-index: 70; display: grid; grid-template-rows: auto 1fr auto; gap: 10px;">
    <div class="row" style="justify-content: space-between; align-items: center;">
      <strong>Reservar ruta compartida</strong>
      <button id="clientSharedClose" class="secondary">Cerrar</button>
    </div>
    <div style="min-height:0; overflow:auto;">
      <div id="clientSharedSummary" class="list" style="margin-bottom:8px"></div>
      <form id="clientSharedForm" class="form">
        <div class="two-col">
          <label>Dirección de recogida
            <div class="row" style="gap:8px; align-items:center;">
              <input id="sharedDireccion" placeholder="Selecciona en el mapa" required readonly style="flex:1" />
              <button type="button" id="sharedMapBtn" class="secondary">Ubicar en mapa</button>
            </div>
          </label>
          <label>Número de personas
            <input id="sharedPersonas" type="number" min="1" max="10" required />
          </label>
        </div>
        <label>Equipaje / Comentarios
          <input id="sharedEquipaje" placeholder="Maletas, objetos frágiles, etc." />
        </label>
        <div class="row" style="justify-content: flex-end; gap: 8px;">
          <button type="submit" class="accent">Continuar a pago</button>
        </div>
      </form>
    </div>
    <div class="row" style="justify-content: flex-end; gap: 8px;"></div>
  </div>

  <!-- Payment View -->
  <section id="view-payment" class="view" hidden>
    <div class="panel" style="max-width: 900px; margin: 0 auto;">
      <h2>Pago de reserva</h2>
      <div id="paySummary" class="list" style="margin-bottom:10px"></div>
      <form id="payForm" class="form">
        <div class="two-col">
          <label>Método de pago
            <select id="payMethod" required>
              <option value="efectivo">Efectivo</option>
              <option value="tarjeta">Tarjeta</option>
              <option value="transferencia">Transferencia</option>
              <option value="voucher">Voucher empresarial</option>
            </select>
          </label>
          <label>Cupón/Voucher (opcional)
            <input id="payCodigoPromo" placeholder="CUPON10 o VOC-123" />
          </label>
        </div>
        
        <div id="empresaTarifaSection" style="display: none;">
          <label>Tarifa de tu empresa (opcional)
            <input id="empresaTarifa" type="number" min="0" step="0.01" placeholder="0.00" />
            <small style="color: var(--muted); font-size: 12px;">Esta tarifa se sumará al precio del transporte</small>
          </label>
        </div>

        <div id="payInstructions" class="detail-section" style="margin-top:6px;">
          <div class="label">Indicaciones</div>
          <div class="value" id="payInstructionsText">Selecciona un método de pago para ver los pasos a seguir.</div>
        </div>

        <div id="payCardFields" style="display:none; margin-top:6px;">
          <div class="two-col">
            <label>Número de tarjeta
              <input id="payCardNumber" inputmode="numeric" maxlength="19" placeholder="1234 5678 9012 3456" />
            </label>
            <label>Expiración (MM/AA)
              <input id="payCardExp" placeholder="MM/AA" />
            </label>
          </div>
          <div class="two-col">
            <label>Nombre en tarjeta
              <input id="payCardName" />
            </label>
            <label>CVV
              <input id="payCardCvv" inputmode="numeric" maxlength="4" />
            </label>
          </div>
        </div>

        <div id="payTransferFields" style="display:none; margin-top:6px;">
          <div class="two-col">
            <label>Banco
              <input id="payBank" placeholder="Banco Ejemplo" />
            </label>
            <label>Número de referencia
              <input id="payRef" placeholder="ABC123456" />
            </label>
          </div>
        </div>

        <div class="row" style="justify-content: space-between; align-items: center; margin-top: 8px;">
          <button type="button" id="payCancel" class="secondary">Cancelar</button>
          <div class="row" style="gap:8px; align-items:center;">
            <span class="badge" id="payTotal">$0</span>
            <button type="submit" class="accent">Pagar / Confirmar</button>
          </div>
        </div>
        <div id="payMsg" class="msg"></div>
      </form>
    </div>
  </section>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="app.js"></script>
</body>
</html>


