<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TeLlevo - Prototipo</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">TeLlevo</div>
    
    <div class="session">
      <select id="companySelect">
        <option value="TeLlevo">TeLlevo</option>
        <option value="AndesTours">AndesTours</option>
        <option value="AmazoniaTravel">AmazoniaTravel</option>
      </select>
      <span id="sessionUser">Sin sesión</span>
      <button id="logoutBtn" class="secondary" title="Cerrar sesión">Salir</button>
    </div>
  </header>

  <main id="app">
    <!-- Auth View -->
    <section id="view-auth" class="view">
      <div id="auth-login" class="panel">
        <h2>Iniciar sesión</h2>
        <form id="loginForm" class="form">
          <label>Correo
            <input id="loginEmail" type="email" required />
          </label>
          <label>Contraseña
            <input id="loginPassword" type="password" required />
          </label>
          <button type="submit">Entrar</button>
        </form>
        <div id="loginMsg" class="msg"></div>
        <div class="msg" style="margin-top:10px">
          ¿No tienes cuenta? <a href="#" id="goToRegister">Regístrate</a>
        </div>
        
      </div>
      <div id="auth-register" class="panel" hidden>
        <h2>Registro</h2>
        <form id="registerForm" class="reg-grid">
          <div class="reg-left">
            <div class="two-col">
              <label>Nombres
                <input id="regNombres" type="text" required />
              </label>
              <label>Apellidos
                <input id="regApellidos" type="text" required />
              </label>
            </div>
            <div class="two-col">
              <label>CI
                <input id="regCedula" type="text" required />
              </label>
              <label>Teléfono
                <input id="regTelefono" type="tel" />
              </label>
            </div>
            <div class="two-col">
              <label>Correo
                <input id="regEmail" type="email" required />
              </label>
              <label>Contraseña
                <input id="regPassword" type="password" required />
              </label>
            </div>
            <div class="two-col">
              <label>Rol
                <select id="regRole" required>
                  <option value="cliente">Cliente</option>
                  <option value="conductor">Conductor</option>
                </select>
              </label>
            </div>
            <div class="two-col">
              <div class="map-box">
                <button id="openMapPicker" type="button" class="btn ghost" style="width:100%">Ubicar Dirección en mapa</button>
                <div class="text-muted" id="pickedAddress" style="margin-top:6px"></div>
                <input id="regLat" type="hidden" />
                <input id="regLng" type="hidden" />
              </div>
              <label class="span-1">Referencia
                <input id="regReferencia" type="text" />
              </label>
            </div>
            <button type="submit" class="accent" style="margin-top:10px">Registrar</button>
          </div>
          <div class="reg-right">
            <div class="photo-box">
              <img id="regFotoPreview" alt="Vista previa" hidden />
              <button id="regFotoBtn" class="secondary" type="button">Subir foto</button>
              <input id="regFoto" type="file" accept="image/*" hidden />
            </div>
            <div class="text-muted" style="text-align:center; margin-top:6px">Subir Foto</div>
          </div>
        </form>
        <div id="registerMsg" class="msg"></div>
        <div class="msg" style="margin-top:10px">
          ¿Ya tienes cuenta? <a href="#" id="goToLogin">Inicia sesión</a>
        </div>
      </div>
    </section>

    <!-- Cliente View -->
    <section id="view-cliente" class="view cliente-layout">
      <div class="panel cliente-left">
        <h2>Servicios</h2>
        <div class="row" style="gap:8px; flex-wrap: wrap;">
          <label class="badge">Elegir servicio</label>
          <select id="servicioTipo">
            <option value="compartido">Compartido (por asiento)</option>
            <option value="privado">Privado (unidad exclusiva)</option>
            <option value="encomienda">Encomienda express</option>
            <option value="transfer">Transfer (punto a punto)</option>
          </select>
        </div>
      </div>
      <div class="panel cliente-left" id="compartidoPanel">
        <h2>Rutas disponibles (compartido)</h2>
        <div id="rutasList" class="grid"></div>
      </div>
      <div class="panel cliente-left" id="customServicePanel" hidden>
        <h3>Configurar servicio</h3>
        <form id="customServiceForm" class="form">
          <div class="two-col">
            <label>Origen
              <input id="csOrigen" placeholder="Ciudad/Barrio" required />
            </label>
            <label>Destino
              <input id="csDestino" placeholder="Ciudad/Barrio" required />
            </label>
          </div>
          <div class="two-col">
            <label>Horario
              <input id="csHorario" placeholder="HH:MM" required />
            </label>
            <label>Precio estimado
              <input id="csPrecio" type="number" placeholder="Ej. 20" required />
            </label>
          </div>
          <label id="csExtraLabel" hidden>Detalle encomienda
            <input id="csExtra" placeholder="Tamaño/Notas" />
          </label>
          <button type="submit" class="accent">Solicitar</button>
        </form>
      </div>
      <div class="panel cliente-right" id="reservaPanel" hidden>
        <h3>Reservar</h3>
        <div id="reservaInfo"></div>
        <form id="reservaForm" class="form">
          <label>Tipo
            <select id="tipoReserva">
              <option value="asiento">Asiento</option>
              <option value="encomienda">Encomienda</option>
            </select>
          </label>
          <label>Dirección de recogida
            <input id="direccion" type="text" placeholder="Calle y número" required />
          </label>
          <div class="two-col">
            <label>Método de pago
              <select id="metodoPago">
                <option value="efectivo">Efectivo</option>
                <option value="tarjeta">Tarjeta</option>
                <option value="transferencia">Transferencia</option>
                <option value="voucher">Voucher empresarial</option>
              </select>
            </label>
            <label>Cupón/Voucher (opcional)
              <input id="codigoPromo" placeholder="CUPON10 o VOC-123" />
            </label>
          </div>
          <button type="submit" class="accent">Confirmar reserva</button>
        </form>
        <div id="reservaMsg" class="msg"></div>
      </div>
      <div class="panel cliente-right" id="trackingPanel" hidden>
        <h3>Tracking en vivo</h3>
        <div id="trackingInfo" class="list"></div>
      </div>
      <div class="panel cliente-right">
        <h2>Historial de reservas</h2>
        <div id="historialList" class="list"></div>
        <form id="ratingForm" class="form" style="margin-top:10px">
          <div class="two-col">
            <label>Reserva
              <select id="ratingReserva"></select>
            </label>
            <label>Puntaje (1-5)
              <input id="ratingValor" type="number" min="1" max="5" step="1" />
            </label>
          </div>
          <label>Comentario (opcional)
            <input id="ratingComentario" placeholder="Tu experiencia" />
          </label>
          <button type="submit">Enviar calificación</button>
          <div id="ratingMsg" class="msg"></div>
        </form>
      </div>
    </section>

    <!-- Conductor View -->
    <section id="view-conductor" class="view">
      <div class="panel">
        <h2>Viajes asignados</h2>
        <div id="viajesAsignados" class="list"></div>
      </div>
      <div class="panel">
        <h3>GPS</h3>
        <div class="row" style="gap:8px; flex-wrap: wrap;">
          <button id="gpsStart">Compartir GPS</button>
          <button id="gpsStop" class="secondary">Detener</button>
          <span class="badge" id="gpsStatus">Off</span>
        </div>
      </div>
    </section>

    <!-- Admin View -->
    <section id="view-admin" class="view">
      <div class="admin-layout">
        <aside class="admin-tabs">
          <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
          <button class="tab-btn" data-tab="usuarios">Usuarios</button>
          <button class="tab-btn" data-tab="clientes">Clientes</button>
          <button class="tab-btn" data-tab="flota">Flota</button>
          <button class="tab-btn" data-tab="rutas">Rutas</button>
          <button class="tab-btn" data-tab="reservas">Reservas</button>
          <button class="tab-btn" data-tab="promos">Cupones/Vouchers</button>
        </aside>
        <div class="admin-content">
          <div class="tab-panel active" id="tab-dashboard">
            <div class="panel">
              <h2>Dashboard</h2>
              <div class="kpis">
                <div class="kpi"><div class="kpi-num" id="kpiReservas">0</div><div class="kpi-label">Reservas</div></div>
                <div class="kpi"><div class="kpi-num" id="kpiRutas">0</div><div class="kpi-label">Rutas</div></div>
                <div class="kpi"><div class="kpi-num" id="kpiFlota">0</div><div class="kpi-label">Vehículos</div></div>
                <div class="kpi" style="max-width:200px"><div class="kpi-num" id="kpiRating">-</div><div class="kpi-label">Promedio ★</div></div>
                <div class="kpi" style="max-width:220px"><div class="kpi-num" id="kpiRevenue">$0</div><div class="kpi-label">Ingresos estimados</div></div>
              </div>
            </div>
            <div class="panel two-col">
              <div>
                <h3>Reservas recientes</h3>
                <div id="adminRecent" class="list"></div>
                <h3 style="margin-top:16px">Top rutas</h3>
                <div id="adminTopRutas" class="list"></div>
              </div>
              <div>
                <h3>Uso de flota</h3>
                <div id="adminFleetStats" class="list"></div>
                <h3 style="margin-top:16px">Uso de promociones</h3>
                <div id="adminPromoStats" class="list"></div>
              </div>
            </div>
          </div>

          <div class="tab-panel" id="tab-usuarios">
            <div class="panel">
              <h3>Usuarios</h3>
              <div class="row" style="justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span class="text-muted">Gestión de conductores y administradores</span>
                <button class="btn primary" id="addUsuarioBtn">+ Agregar Usuario</button>
              </div>
              <div id="adminUsuarios" class="list"></div>
            </div>
          </div>

          <div class="tab-panel" id="tab-clientes">
            <div class="panel">
              <h3>Clientes</h3>
              <div class="row" style="justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span class="text-muted">Gestión de clientes registrados</span>
              </div>
              <div id="adminClientes" class="list"></div>
            </div>
          </div>

          <div class="tab-panel" id="tab-flota">
            <div class="panel">
              <h3>Flota</h3>
              <div class="row" style="justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span class="text-muted">Gestión de vehículos de la flota</span>
                <button class="btn primary" id="addFlotaBtn">+ Agregar Vehículo</button>
              </div>
              <div id="adminFlota" class="list"></div>
            </div>
          </div>

          <div class="tab-panel" id="tab-rutas">
            <div class="panel">
              <h3>Gestión de rutas</h3>
              <div id="adminRutas" class="list"></div>
              <form id="rutaForm" class="form inline">
                <input id="rutaOrigen" placeholder="Origen" required />
                <input id="rutaDestino" placeholder="Destino" required />
                <input id="rutaHorario" placeholder="Horario (HH:MM)" required />
                <input id="rutaPrecio" type="number" placeholder="Precio" required />
                <input id="rutaAsientos" type="number" placeholder="Asientos" required />
                <button type="submit">Añadir ruta</button>
              </form>
              <div id="rutaMsg" class="msg"></div>
            </div>
          </div>

          <div class="tab-panel" id="tab-reservas">
            <div class="panel">
              <h3>Gestión de reservas</h3>
              <div id="adminReservas" class="list"></div>
              <h3 style="margin-top:16px">Asignación de viajes</h3>
              <form id="assignForm" class="form inline" style="grid-template-columns: 2fr 2fr auto;">
                <select id="assignReserva"></select>
                <select id="assignConductor"></select>
                <button type="submit">Asignar</button>
              </form>
              <div id="assignMsg" class="msg"></div>
              <h3 style="margin-top:16px">Facturas</h3>
              <div id="adminInvoices" class="list"></div>
            </div>
          </div>

          <div class="tab-panel" id="tab-promos">
            <div class="panel">
              <h3>Cupones y Vouchers</h3>
              <div id="adminPromos" class="list"></div>
              <form id="promoForm" class="form inline" style="grid-template-columns: 1fr 1fr auto;">
                <select id="promoTipo">
                  <option value="cupon">Cupón</option>
                  <option value="voucher">Voucher</option>
                </select>
                <input id="promoCodigo" placeholder="CUPON10 o VOC-001" required />
                <button type="submit">Agregar</button>
              </form>
              <div id="promoMsg" class="msg"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Admin Create User View -->
    <section id="view-admin-user-new" class="view" hidden>
      <div class="panel" style="max-width: 900px; margin: 0 auto;">
        <h2>Nuevo usuario</h2>
        <form id="adminCreateUserForm" class="form">
          <div class="two-col">
            <label>Nombre completo
              <input id="auNombre" type="text" required />
            </label>
            <label>CI
              <input id="auCedula" type="text" required />
            </label>
          </div>
          <div class="two-col">
            <label>Rol
              <select id="auRole" required>
                <option value="conductor">Conductor</option>
                <option value="admin">Administrador</option>
              </select>
            </label>
            <label>Teléfono
              <input id="auTelefono" type="tel" />
            </label>
          </div>
          <div class="two-col">
            <label>Correo
              <input id="auEmail" type="email" required />
            </label>
            <label>Contraseña
              <input id="auPassword" type="password" required />
            </label>
          </div>
          <label>Dirección
            <input id="auDireccion" type="text" />
          </label>
          <div class="two-col">
            <div class="photo-box">
              <img id="auFotoPreview" alt="Vista previa" hidden />
              <button id="auFotoBtn" class="secondary" type="button">Subir foto</button>
              <input id="auFoto" type="file" accept="image/*" hidden />
            </div>
            <div class="text-muted" style="display:flex; align-items:center">Foto del usuario (opcional)</div>
          </div>
          <div class="row" style="justify-content: flex-end; gap: 8px; margin-top: 8px;">
            <button type="button" id="auCancelar" class="secondary">Cancelar</button>
            <button type="submit" class="accent">Crear usuario</button>
          </div>
          <div id="auMsg" class="msg"></div>
        </form>
      </div>
    </section>
  </main>


  <div id="toast" class="toast" hidden></div>

  <!-- Map Picker Modal -->
  <div id="mapModal" class="panel" hidden style="position: fixed; inset: 0; margin: auto; max-width: 900px; max-height: 80vh; z-index: 60; grid-template-rows: auto 1fr auto; gap: 10px;">
    <div class="row" style="justify-content: space-between; align-items: center;">
      <strong>Seleccionar ubicación</strong>
      <button id="closeMapPicker" class="secondary">Cerrar</button>
    </div>
    <div id="map" style="height: 60vh; border:1px solid var(--border); border-radius: 10px;"></div>
    <div class="row" style="gap:10px; flex-wrap: wrap;">
      <span class="badge" id="mapCoords">-,-</span>
      <span class="text-muted" id="mapAddress"></span>
      <button id="saveMapPicker" class="accent">Usar esta ubicación</button>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="app.js"></script>
</body>
</html>


